<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Flow Execution - The `flow` Guide</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="A guide to what 'flow' is and how to use it">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">var path_to_root = "../";</script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li class="affix"><a href="../welcome.html">Welcome!</a></li><li class="spacer"></li><li><a href="../introduction/introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li><a href="../introduction/what_is_flow.html"><strong aria-hidden="true">1.1.</strong> What is flow</a></li><li><a href="../introduction/components.html"><strong aria-hidden="true">1.2.</strong> Components</a></li><li><a href="../introduction/inspirations.html"><strong aria-hidden="true">1.3.</strong> The Inspirations for flow</a></li><li><a href="../introduction/non_inspirations.html"><strong aria-hidden="true">1.4.</strong> Non-Inspirations</a></li><li><a href="../introduction/status.html"><strong aria-hidden="true">1.5.</strong> Status</a></li><li><a href="../introduction/flow_programming.html"><strong aria-hidden="true">1.6.</strong> Flow Programming</a></li></ol></li><li><a href="../first_flow/first_flow.html"><strong aria-hidden="true">2.</strong> Your First Flow</a></li><li><ol class="section"><li><a href="../first_flow/understanding.html"><strong aria-hidden="true">2.1.</strong> Understanding it</a></li><li><a href="../first_flow/implementation.html"><strong aria-hidden="true">2.2.</strong> Real Implementation</a></li><li><a href="../first_flow/step-by-step.html"><strong aria-hidden="true">2.3.</strong> Step-by-Step</a></li><li><a href="../first_flow/debugging.html"><strong aria-hidden="true">2.4.</strong> Debugging your first flow</a></li></ol></li><li><a href="../describing/definition_overview.html"><strong aria-hidden="true">3.</strong> Describing Flows</a></li><li><ol class="section"><li><a href="../describing/names.html"><strong aria-hidden="true">3.1.</strong> Names</a></li><li><a href="../describing/ios.html"><strong aria-hidden="true">3.2.</strong> Flow IOs</a></li><li><a href="../describing/process_references.html"><strong aria-hidden="true">3.3.</strong> Process References</a></li><li><a href="../describing/value_definitions.html"><strong aria-hidden="true">3.4.</strong> Value Definitions</a></li><li><a href="../describing/function_definitions.html"><strong aria-hidden="true">3.5.</strong> Function Definitions</a></li><li><a href="../describing/types.html"><strong aria-hidden="true">3.6.</strong> Types</a></li><li><a href="../describing/connections.html"><strong aria-hidden="true">3.7.</strong> Connections</a></li><li><a href="../describing/io_references.html"><strong aria-hidden="true">3.8.</strong> IO References</a></li><li><a href="../describing/features.html"><strong aria-hidden="true">3.9.</strong> Complete Feature List</a></li><li><a href="../describing/flow_libraries.html"><strong aria-hidden="true">3.10.</strong> Flow Libraries</a></li></ol></li><li><a href="../running/running.html"><strong aria-hidden="true">4.</strong> Running flows</a></li><li><ol class="section"><li><a href="../running/flowc.html"><strong aria-hidden="true">4.1.</strong> flowc Command Line Arguments</a></li><li><a href="../running/arguments.html"><strong aria-hidden="true">4.2.</strong> Passing command line arguments to flows</a></li><li><a href="../running/context_selection.html"><strong aria-hidden="true">4.3.</strong> Selecting the Context file</a></li><li><a href="../running/stdio.html"><strong aria-hidden="true">4.4.</strong> Standard Input and Output</a></li><li><a href="../running/panics.html"><strong aria-hidden="true">4.5.</strong> Exceptions and Panics</a></li></ol></li><li><a href="../samples/overview.html"><strong aria-hidden="true">5.</strong> Samples</a></li><li><ol class="section"><li><a href="../samples/first/DESCRIPTION.html"><strong aria-hidden="true">5.1.</strong> first sample</a></li><li><a href="../samples/echo/DESCRIPTION.html"><strong aria-hidden="true">5.2.</strong> echo sample</a></li><li><a href="../samples/fibonacci/DESCRIPTION.html"><strong aria-hidden="true">5.3.</strong> fibonacci sample</a></li><li><a href="../samples/hello-world-include/DESCRIPTION.html"><strong aria-hidden="true">5.4.</strong> hello-world-include sample</a></li><li><a href="../samples/hello-world-simple/DESCRIPTION.html"><strong aria-hidden="true">5.5.</strong> hello-world-simple sample</a></li><li><a href="../samples/hello-world/DESCRIPTION.html"><strong aria-hidden="true">5.6.</strong> hello-world sample</a></li><li><a href="../samples/line-echo/DESCRIPTION.html"><strong aria-hidden="true">5.7.</strong> line-echo sample</a></li></ol></li><li><a href="../flowstdlib/flowstdlib.html"><strong aria-hidden="true">6.</strong> The flow standard library</a></li><li><ol class="section"><li><a href="../flowstdlib/src/control/control.html"><strong aria-hidden="true">6.1.</strong> Control functions</a></li><li><ol class="section"><li><a href="../flowstdlib/src/control/tap.html"><strong aria-hidden="true">6.1.1.</strong> Tap function</a></li><li><a href="../flowstdlib/src/control/compare.html"><strong aria-hidden="true">6.1.2.</strong> Compare function</a></li></ol></li><li><a href="../flowstdlib/src/fmt/fmt.html"><strong aria-hidden="true">6.2.</strong> Formatting Functions</a></li><li><ol class="section"><li><a href="../flowstdlib/src/fmt/to_number.html"><strong aria-hidden="true">6.2.1.</strong> To Number function</a></li><li><a href="../flowstdlib/src/fmt/to_string.html"><strong aria-hidden="true">6.2.2.</strong> To String function</a></li></ol></li><li><a href="../flowstdlib/src/img/img.html"><strong aria-hidden="true">6.3.</strong> Image Functions</a></li><li><ol class="section"><li><a href="../flowstdlib/src/img/format_png.html"><strong aria-hidden="true">6.3.1.</strong> Format PNG function</a></li></ol></li><li><a href="../flowstdlib/src/math/math.html"><strong aria-hidden="true">6.4.</strong> Math Functions</a></li><li><ol class="section"><li><a href="../flowstdlib/src/math/add.html"><strong aria-hidden="true">6.4.1.</strong> Add function</a></li><li><a href="../flowstdlib/src/math/subtract.html"><strong aria-hidden="true">6.4.2.</strong> Subtract function</a></li><li><a href="../flowstdlib/src/math/divide.html"><strong aria-hidden="true">6.4.3.</strong> Divide function</a></li></ol></li></ol></li><li><a href="../flowr/flowr.html"><strong aria-hidden="true">7.</strong> The flow runtime library</a></li><li><ol class="section"><li><a href="../flowr/src/args/args.html"><strong aria-hidden="true">7.1.</strong> Arg functions</a></li><li><ol class="section"><li><a href="../flowr/src/args/get.html"><strong aria-hidden="true">7.1.1.</strong> Arg get function</a></li></ol></li><li><a href="../flowr/src/file/file.html"><strong aria-hidden="true">7.2.</strong> File functions</a></li><li><ol class="section"><li><a href="../flowr/src/file/file_write.html"><strong aria-hidden="true">7.2.1.</strong> File Write function</a></li></ol></li><li><a href="../flowr/src/stdio/stdio.html"><strong aria-hidden="true">7.3.</strong> Standard IO functions</a></li><li><ol class="section"><li><a href="../flowr/src/stdio/readline.html"><strong aria-hidden="true">7.3.1.</strong> Readlin function</a></li><li><a href="../flowr/src/stdio/stdin.html"><strong aria-hidden="true">7.3.2.</strong> Standard Input function</a></li><li><a href="../flowr/src/stdio/stdout.html"><strong aria-hidden="true">7.3.3.</strong> Standard Output function</a></li><li><a href="../flowr/src/stdio/stderr.html"><strong aria-hidden="true">7.3.4.</strong> Standard Error function</a></li></ol></li></ol></li><li><a href="../developing/overview.html"><strong aria-hidden="true">8.</strong> Developing 'flow'</a></li><li><ol class="section"><li><a href="../developing/prereqs.html"><strong aria-hidden="true">8.1.</strong> Pre-requisites</a></li><li><a href="../developing/make.html"><strong aria-hidden="true">8.2.</strong> Makefile targets</a></li><li><a href="../developing/contributing.html"><strong aria-hidden="true">8.3.</strong> Ways to contribute</a></li><li><ol class="section"><li><a href="../developing/issues.html"><strong aria-hidden="true">8.3.1.</strong> Issues</a></li><li><a href="../developing/prs.html"><strong aria-hidden="true">8.3.2.</strong> PRs</a></li><li><a href="../samples/sample_development.html"><strong aria-hidden="true">8.3.3.</strong> Developing a sample</a></li><li><a href="../developing/ci.html"><strong aria-hidden="true">8.3.4.</strong> Continuous Integration Tests</a></li></ol></li></ol></li><li><a href="../internals/overview.html"><strong aria-hidden="true">9.</strong> Internals of 'flow</a></li><li><ol class="section"><li><a href="../internals/flow_loading.html"><strong aria-hidden="true">9.1.</strong> Flow Loading</a></li><li><a href="../internals/flow_compiling.html"><strong aria-hidden="true">9.2.</strong> Flow Compiling</a></li><li><a href="../internals/flow_execution.html" class="active"><strong aria-hidden="true">9.3.</strong> Flow Execution</a></li></ol></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">The `flow` Guide</h1> 

                        <div class="right-buttons">
                            <a href="../print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="#flow-execution" id="flow-execution"><h2>Flow Execution</h2></a>
<a class="header" href="#lazy-execution" id="lazy-execution"><h3>Lazy Execution</h3></a>
<p>Execution should be as lazy as possible.</p>
<p>The only thing that determines if a function is run is the availability at it's inputs of the data
it needs to run, and the ability to produce the result at it's output by having the output free.</p>
<p>If the output is free because a second function is running and hasn't consumed it's input, then
the first function will be blocked and computing resources will be used on the functions that most
need it. When they complete and produce an output, that output may satisfy another functions's
inputs which in turn will run, and so on and so forth.</p>
<a class="header" href="#execution-states" id="execution-states"><h3>Execution States</h3></a>
<p>Runnables (Values and Functions) can be in one of two states:</p>
<ul>
<li>blocked (either pending an input or output is blocked)</li>
<li>runnable (inputs are satisfied, output is free and it can be run anytime)</li>
</ul>
<a class="header" href="#value-rules" id="value-rules"><h3>Value Rules</h3></a>
<p>A Value has only one input, but that can be connected to and a value offered by multiple &quot;writers&quot;.
It has only one output, but that can be connected to and listened on by multiple &quot;listeners&quot;</p>
<p>It stores a value, that can be initialized when the program is loaded to an initial value.</p>
<p>When the value is empty it can be updated.
When it is updated, the value is made available to all &quot;listeners&quot; at it's output.
While it stores a value, it cannot be updated, and any writer will be blocked until the value is
consumed and can be updated again.</p>
<p>Each of the listeners can read or &quot;consume&quot; the value once.</p>
<p>When it has been consumed by all listeners, the value becomes empty (None) and can be updated again.
It does not become empty until all listeners have consumed the value.</p>
<p>You can think of Values as a FIFO of size 1 for each listener connected to it.</p>
<a class="header" href="#function-rules" id="function-rules"><h3>Function Rules</h3></a>
<p>The operation of a Function is similar to that of a value, except that it can have multiple inputs
and it is not run until they are all satisfied.</p>
<p>A function does not store any value or state, beyond making it's output available to listeners
asynchronously.</p>
<p>A Function can have zero or more inputs.
Each input can be connected to and written to by multiple &quot;writers&quot;.
It has only one output, but that can be connected to and listened to by multiple &quot;listeners&quot;.</p>
<p>A Function can only run when a value is available at each of it's inputs and it's output is
free to write to.. It is blocked from running until these conditions are met.</p>
<p>When a function runs, it produces an output that is made available to all &quot;listeners&quot; at it's output.</p>
<p>Each of the listeners can read or &quot;consume&quot; the output value once.</p>
<a class="header" href="#generalized-rules" id="generalized-rules"><h3>Generalized Rules</h3></a>
<p>If we consider a value to be like a null function that does no calculation, but just passes the input
value to it's outputs - then we can state some general rules that apply to the &quot;running&quot; of both.</p>
<ul>
<li>Can have zero or more inputs (max 1 for a Value)</li>
<li>Each input can be connected to and values offered to it by multiple &quot;writers&quot;.</li>
<li>Has one output, that can be listened on by multiple &quot;listeners&quot;.</li>
<li>Can only be run (updated) when a value is available at each of the inputs and the output is
free to write to. Is blocked from running until these conditions are met.</li>
<li>When ran, it produces an output that is made available to all &quot;listeners&quot; at it's output.</li>
<li>Each of the listeners can read or &quot;consume&quot; the output value only once.</li>
<li>Once the output has been consumed (once) by all the listeners, then the output is free to be
written to again.</li>
</ul>
<a class="header" href="#executuion-process" id="executuion-process"><h2>Executuion Process</h2></a>
<a class="header" href="#loading" id="loading"><h3>Loading</h3></a>
<p>All functions and values are loaded.</p>
<a class="header" href="#initialization" id="initialization"><h3>Initialization</h3></a>
<p>Any values with initial values are initialized with them and hence make them available on their
output, and hence they are made available on the input of all connected objects (values and functions).</p>
<p>Now, the execution loop can be started.</p>
<a class="header" href="#execution-loop" id="execution-loop"><h3>Execution Loop</h3></a>
<p>Next ready Runnable is run</p>
<ul>
<li>Next runnable (function/value) on the read list is run
<ul>
<li>this consumes all its inputs
<ul>
<li>this may unblock another runnable which was blocked sending to this runnables as it's input was full</li>
</ul>
</li>
</ul>
</li>
<li>Any data produced is made available on the output</li>
<li>Outputs are made available to all connected inputs on other runnables
<ul>
<li>The data on any ouput is made available to all connected inputs, copied if necessary to multiple.</li>
<li>This may satisfy the inputs of the other runnable, causing it to be added to the ready list</li>
</ul>
</li>
</ul>
<a class="header" href="#parallel-execution" id="parallel-execution"><h3>Parallel Execution</h3></a>
<p>A core goal of 'flow' is to enable parallel execution of programs, with the parallelism being described
inherently in the flow description, via data dependencies and functions with zero side effects.</p>
<p>Currently, the runtime only executes one runnable at a time, but that is destined to change as soon
as it can be implemented, both in multiple threads in the same process on one machine, then multiple
processes on one machine and then across machines across a network.</p>
<a class="header" href="#termination" id="termination"><h3>Termination</h3></a>
<p>The execution of a flow terminates when there are no runnables left on the ready list</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../internals/flow_compiling.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="../internals/flow_compiling.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
            </nav>

        </div>

        

        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
